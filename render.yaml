# Render Blueprint - deploy backend + Postgres
# 1. Push this repo to GitHub and connect to Render
# 2. In Render Dashboard, add env vars to pak-bank-backend: SERP_API_KEY, GROQ_API_KEY
# 3. DATABASE_URL is auto-injected when you link the Postgres DB
#    If asyncpg needs postgresql+asyncpg://, set DATABASE_URL manually from the Postgres Internal URL

databases:
  - name: pakbank-db
    plan: free
    databaseName: pakbank

services:
  - name: pak-bank-backend
    type: web
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: pakbank-db
          property: connectionString
      - key: FAISS_INDEX_PATH
        value: /tmp/faiss.index
      - key: FAISS_METADATA_PATH
        value: /tmp/faiss_metadata.json
      - key: SCRAPE_INTERVAL_HOURS
        value: "12"
      - key: LOG_LEVEL
        value: INFO
      # Add these in Render Dashboard (Environment):
      # SERP_API_KEY, GROQ_API_KEY
